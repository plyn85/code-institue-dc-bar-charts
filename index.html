<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />

    <title>D3 and Scalable Vector Graphics</title>

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.min.css"
      type="text/css"
    />
    <style>
      /* clear left added so each chart displays on its own line */
      div {
        clear: left;
      }
    </style>

    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.js"
    ></script>
    <!-- libary that allows you to defer calling a function until the data is ready -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"
    ></script>
  </head>
  <body>
    <!-- adding divs for the bar charts here -->

    <div>
      <h3>Total Spend Per Month</h3>
      <div id="spend-per-month"></div>
    </div>

    <script>
      queue()
        .defer(d3.json, "data.json") // this  gets the json file brings it back in the form of d3
        .await(makeGraphs); // what every you call function here must match custom function below

      function makeGraphs(error, transactionsData) {
        var ndx = crossfilter(transactionsData); //cross filter will group the data by batch an then compute the sum of those batches

        var parseDate = d3.time.format("%d/%m/%Y").parse; // making sure the data here is formatted in a way that can be repersented by crossfilter,dc and d3

        transactionsData.forEach(function(d) {
          // must be a capital Y in format function!
          //looping trough the date entries with a four each function here

          d.date = parseDate(d.date); //parsing(converting some sort of date an time infomation into am object) the date entries here
        });

        var date_dim = ndx.dimension(dc.pluck("date")); //using the demension method here to divide the dates from the rest an plucking them from array
        var total_spend_per_date = date_dim
          .group()
          .reduceSum(dc.pluck("spend")); // getting total spend per month here

        var minDate = date_dim.bottom(1)[0].date; // getting min an max dates here
        var maxDate = date_dim.top(1)[0].date;

        dc.lineChart("#spend-per-month") // creating a line chart here targeting div id from above
          .width(1000)
          .height(300)
          .margins({ top: 10, right: 50, bottom: 30, left: 50 }) // these are realitive to the div thats targeted above  not to the entire screen
          .dimension(date_dim) //passing in var from above to dimsensions function
          .group(total_spend_per_date) //passing in var from above to group function
          .transitionDuration(500) //transition function added here
          .x(d3.time.scale().domain([minDate, maxDate])) // setting min an max dates on x axis here
          .xAxisLabel("Month") // adding month to x axis
          .yAxis()
          .ticks(4); //adding the amount of ticks to y axis

        dc.renderAll();
      }
    </script>
  </body>
</html>
